<UserControl
    x:Class="MahTemp.Views.DetectionPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="clr-namespace:MahTemp.ViewModels"
    d:DataContext="{d:DesignInstance Type=viewmodels:DetectionViewModel}"
    d:DesignHeight="600"
    d:DesignWidth="1000"
    mc:Ignorable="d">
    <UserControl.Resources>
        <Style BasedOn="{StaticResource MahApps.Styles.MetroHeader.Horizontal}" TargetType="mah:MetroHeader" />
        <Style BasedOn="{StaticResource MahApps.Styles.Button.Flat}" TargetType="Button" />
    </UserControl.Resources>

    <mah:SplitView
        x:Name="OptionsSplitView"
        DisplayMode="Overlay"
        IsPaneOpen="False"
        PanePlacement="Right">
        <mah:SplitView.Pane>
            <Border Background="{DynamicResource MahApps.Brushes.ThemeBackground}">
                <Grid Margin="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal">
                        <TextBlock
                            VerticalAlignment="Center"
                            FontSize="18"
                            FontWeight="SemiBold"
                            Text="检测选项" />
                    </StackPanel>

                    <ScrollViewer
                        Grid.Row="1"
                        Margin="0,15,0,0"
                        VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <mah:MetroHeader Header="置信度阈值">
                                <mah:NumericUpDown
                                    Interval="0.01"
                                    Maximum="1"
                                    Minimum="0.01"
                                    StringFormat="F2"
                                    Value="{Binding ConfidenceThreshold}" />
                            </mah:MetroHeader>

                            <mah:MetroHeader Margin="0,10,0,0" Header="NMS阈值">
                                <mah:NumericUpDown
                                    Interval="0.01"
                                    Maximum="1"
                                    Minimum="0.01"
                                    StringFormat="F2"
                                    Value="{Binding NmsThreshold}" />
                            </mah:MetroHeader>

                            <mah:MetroHeader Margin="0,10,0,0" Header="边框粗细">
                                <mah:NumericUpDown
                                    Interval="1"
                                    Maximum="10"
                                    Minimum="1"
                                    Value="{Binding BoxThickness}" />
                            </mah:MetroHeader>

                            <mah:MetroHeader Margin="0,10,0,0" Header="字体大小">
                                <mah:NumericUpDown
                                    Interval="0.1"
                                    Maximum="3"
                                    Minimum="0.3"
                                    StringFormat="F1"
                                    Value="{Binding FontScale}" />
                            </mah:MetroHeader>

                            <mah:ToggleSwitch
                                Margin="0,15,0,0"
                                Content="显示标签"
                                IsOn="{Binding ShowLabel}" />

                            <mah:ToggleSwitch
                                Margin="0,10,0,0"
                                Content="显示置信度"
                                IsOn="{Binding ShowConfidence}" />

                            <mah:MetroHeader Margin="0,15,0,0" Header="边框颜色">
                                <mah:ColorPicker SelectedColor="{Binding BoxColor}" />
                            </mah:MetroHeader>

                            <mah:MetroHeader Margin="0,10,0,0" Header="文字颜色">
                                <mah:ColorPicker SelectedColor="{Binding TextColor}" />
                            </mah:MetroHeader>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>
        </mah:SplitView.Pane>

        <Grid>
            <TabControl
                mah:TabControlHelper.Transition="LeftReplace"
                mah:TabControlHelper.Underlined="TabPanel"
                Background="Transparent"
                Style="{StaticResource MahApps.Styles.TabControl.Animated}">
                <TabItem Header="Onnx">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Orientation="Horizontal">
                            <mah:MetroHeader Margin="10,0" Header="Onnx列表：">
                                <ComboBox
                                    Width="120"
                                    DisplayMemberPath="Name"
                                    ItemsSource="{Binding OnnxSources}"
                                    SelectedItem="{Binding SelectedOnnxModel}" />
                            </mah:MetroHeader>
                            <mah:MetroHeader Margin="10,0" Header="标签列表：">
                                <mah:MultiSelectionComboBox
                                    MinWidth="120"
                                    mah:MultiSelectorHelper.SelectedItems="{Binding SelelctedLabels}"
                                    mah:TextBoxHelper.AutoWatermark="True"
                                    mah:TextBoxHelper.UseFloatingWatermark="True"
                                    ItemsSource="{Binding LabesSource}"
                                    SelectedItemContainerStyle="{StaticResource MahApps.Styles.MultiSelectionComboBoxSelectedItem.Removable}" />
                            </mah:MetroHeader>

                            <mah:DropDownButton
                                Margin="5,0"
                                Padding="10,5"
                                Content="加载标签列表">
                                <mah:DropDownButton.ItemsSource>
                                    <x:Array Type="{x:Type MenuItem}">
                                        <MenuItem
                                            Command="{Binding LoadLabelsFromEnumCommand}"
                                            Header="从枚举获取标签名称"
                                            IsEnabled="False" />
                                        <MenuItem Command="{Binding LoadLabesFromFileCommand}" Header="从文件获取标签列表" />
                                    </x:Array>
                                </mah:DropDownButton.ItemsSource>
                            </mah:DropDownButton>
                        </StackPanel>

                        <Grid Grid.Row="1" Margin="0,12">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <StackPanel
                                Grid.Row="0"
                                Grid.ColumnSpan="2"
                                Orientation="Horizontal">
                                <Button
                                    Margin="10,0"
                                    Command="{Binding LoadImageCommand}"
                                    Content="加载图片" />
                                <Button
                                    Margin="10,0"
                                    Command="{Binding StartDetectionCommand}"
                                    Content="开始检测" />
                                <Button Margin="10,0" Content="检测选项">
                                    <i:Interaction.Triggers>
                                        <i:EventTrigger EventName="Click">
                                            <i:ChangePropertyAction
                                                PropertyName="IsPaneOpen"
                                                TargetObject="{Binding ElementName=OptionsSplitView}"
                                                Value="True" />
                                        </i:EventTrigger>
                                    </i:Interaction.Triggers>
                                </Button>
                            </StackPanel>

                            <Border
                                Grid.Row="1"
                                Grid.Column="0"
                                Margin="10,8"
                                BorderBrush="{StaticResource MahApps.Brushes.Accent}"
                                BorderThickness="0.5">
                                <Image Source="{Binding OriginalImage}" Stretch="Uniform" />
                            </Border>

                            <Border
                                Grid.Row="1"
                                Grid.Column="1"
                                Margin="10,8"
                                BorderBrush="{StaticResource MahApps.Brushes.Accent}"
                                BorderThickness="0.5">
                                <Image Source="{Binding ResultImage}" Stretch="Uniform" />
                            </Border>
                        </Grid>
                    </Grid>
                </TabItem>

                <TabItem Header="OpenCv" />
            </TabControl>
        </Grid>
    </mah:SplitView>
</UserControl>
